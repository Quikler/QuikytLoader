<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:QuikytLoader.ViewModels"
             xmlns:models="using:QuikytLoader.Models"
             xmlns:ui="using:FluentAvalonia.UI.Controls"
             xmlns:i="using:Avalonia.Xaml.Interactivity"
             xmlns:ia="using:Avalonia.Xaml.Interactions.Core"
             x:Class="QuikytLoader.Views.HomeView"
             x:DataType="vm:HomeViewModel">

    <Design.DataContext>
        <vm:HomeViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="Auto,*,Auto,Auto" Margin="40">

        <!-- Main Content -->
        <StackPanel Grid.Row="0" Spacing="24" VerticalAlignment="Center">

            <!-- Title Section -->
            <StackPanel Spacing="8">
                <TextBlock Text="YouTube to Telegram"
                           FontSize="32"
                           FontWeight="Bold"
                           Foreground="{DynamicResource AccentFillColorDefaultBrush}"/>
                <TextBlock Text="Download YouTube videos and send them directly to your Telegram"
                           FontSize="14"
                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
            </StackPanel>

            <!-- Input Card -->
            <Border Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24">
                <StackPanel Spacing="20">

                    <!-- URL Input Section -->
                    <StackPanel Spacing="8">
                        <TextBlock Text="YouTube URL"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                        <TextBox Text="{Binding YoutubeUrl, Mode=TwoWay}"
                                 Watermark="https://www.youtube.com/watch?v=..."
                                 FontSize="14"
                                 Height="40"
                                 VerticalContentAlignment="Center"
                                 KeyDown="TextBox_KeyDown"/>

                        <TextBlock Text="Paste a YouTube video or music URL"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                    </StackPanel>

                    <!-- Edit Title Section -->
                    <StackPanel Spacing="8">
                        <CheckBox IsChecked="{Binding EditTitle, Mode=TwoWay}"
                                  Content="Edit title"
                                  FontSize="14"/>

                        <TextBox Text="{Binding CustomTitle, Mode=TwoWay}"
                                 Watermark="Video title will appear here..."
                                 FontSize="14"
                                 Height="40"
                                 VerticalContentAlignment="Center"
                                 IsVisible="{Binding IsWaitingForProceed}"
                                 IsEnabled="{Binding IsTitleFetched}"/>

                        <TextBlock Text="{Binding TitleFetchStatus}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                   IsVisible="{Binding IsWaitingForProceed}"/>
                    </StackPanel>

                    <!-- Add to Queue / Proceed Button -->
                    <Button Command="{Binding AddToQueueCommand}"
                            HorizontalAlignment="Stretch"
                            Height="48"
                            FontSize="16"
                            FontWeight="SemiBold"
                            IsDefault="False"
                            Classes.proceed="{Binding IsProceedButtonState}">
                        <Button.Styles>
                            <Style Selector="Button">
                                <Setter Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Style>
                            <Style Selector="Button.proceed">
                                <Setter Property="Background" Value="#90EE90"/>
                                <Setter Property="Foreground" Value="#2D5016"/>
                            </Style>
                            <Style Selector="Button.proceed:pointerover /template/ ContentPresenter">
                                <Setter Property="Background" Value="#7FD87F"/>
                            </Style>
                            <Style Selector="Button.proceed:pressed /template/ ContentPresenter">
                                <Setter Property="Background" Value="#6FC76F"/>
                            </Style>
                        </Button.Styles>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <!-- Add icon when in normal state -->
                            <ui:SymbolIcon Symbol="Add"
                                           FontSize="20"
                                           IsVisible="{Binding !IsProceedButtonState}"/>
                            <!-- Play icon when in Proceed state -->
                            <ui:SymbolIcon Symbol="Play"
                                           FontSize="20"
                                           IsVisible="{Binding IsProceedButtonState}"/>
                            <TextBlock Text="{Binding AddToQueueButtonText}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                </StackPanel>
            </Border>

        </StackPanel>

        <!-- Queue List -->
        <Border Grid.Row="1"
                Margin="0,24,0,0"
                Background="{DynamicResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{DynamicResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="8"
                IsVisible="{Binding QueueItems.Count}">
            <DockPanel>
                <!-- Queue Header -->
                <Border DockPanel.Dock="Top"
                        Background="{DynamicResource LayerFillColorDefaultBrush}"
                        Padding="16,12"
                        CornerRadius="8,8,0,0">
                    <TextBlock Text="Download Queue"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
                </Border>

                <!-- Queue Items -->
                <ScrollViewer MaxHeight="400">
                    <ItemsControl ItemsSource="{Binding QueueItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{DynamicResource DividerStrokeColorDefaultBrush}"
                                        BorderThickness="0,0,0,1"
                                        Padding="16,12">
                                    <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                                        <!-- URL -->
                                        <TextBlock Grid.Row="0" Grid.Column="0"
                                                   Text="{Binding Url}"
                                                   FontSize="13"
                                                   TextTrimming="CharacterEllipsis"
                                                   Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>

                                        <!-- Status Badge -->
                                        <Border Grid.Row="0" Grid.Column="1"
                                                Background="{DynamicResource AccentFillColorDefaultBrush}"
                                                CornerRadius="4"
                                                Padding="8,4"
                                                Margin="8,0,0,0">
                                            <TextBlock Text="{Binding Status}"
                                                       FontSize="11"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
                                        </Border>

                                        <!-- Status Message -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                                   Text="{Binding StatusMessage}"
                                                   FontSize="12"
                                                   Margin="0,4,0,0"
                                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>

                                        <!-- Progress Bar -->
                                        <ProgressBar Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                     Value="{Binding Progress}"
                                                     Maximum="100"
                                                     Height="4"
                                                     Margin="0,8,0,0"
                                                     IsVisible="{Binding Status, Converter={x:Static ObjectConverters.Equal}, ConverterParameter={x:Static models:DownloadStatus.Downloading}}"
                                                     ShowProgressText="False"/>

                                        <!-- Error Message -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                   Text="{Binding ErrorMessage}"
                                                   FontSize="11"
                                                   Margin="0,4,0,0"
                                                   Foreground="{DynamicResource SystemFillColorCriticalBrush}"
                                                   IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- Status Message -->
        <Border Grid.Row="3"
                Margin="0,16,0,0"
                Padding="12,8"
                Background="{DynamicResource LayerFillColorDefaultBrush}"
                CornerRadius="6"
                IsVisible="{Binding StatusMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <ui:SymbolIcon Symbol="Alert"
                               FontSize="16"
                               Foreground="{DynamicResource AccentFillColorDefaultBrush}"/>
                <TextBlock Text="{Binding StatusMessage}"
                           FontSize="13"
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextFillColorPrimaryBrush}"/>
            </StackPanel>
        </Border>

    </Grid>

</UserControl>
